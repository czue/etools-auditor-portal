<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../bower_components/web-component-tester/browser.js"></script>

    <!--import [permission-controller]-->
</head>
<body>

<script>

    describe('Permission controller element', function () {
        var behaviorObj;

        beforeEach(function () {
            behaviorObj = APBehaviors.PermissionController;
        });

        describe('method _addToCollection', function() {
            it('is defined', function () {
                assert.isDefined(behaviorObj._addToCollection);
            });

            it('must have two arguments', function () {
                assert.isFalse(behaviorObj._addToCollection('test'));
                assert.isFalse(behaviorObj._addToCollection());
                assert.isTrue(behaviorObj._addToCollection('two_arguments', {}));
            });

            it('accept only object as second argument', function() {
                assert.isFalse(behaviorObj._addToCollection('only_object', []));
                assert.isFalse(behaviorObj._addToCollection('only_object', ''));
                assert.isTrue(behaviorObj._addToCollection('only_object', {}));
            });

            it('return false if first argument is not string or not provided', function() {
                assert.isFalse(behaviorObj._addToCollection([], {}));
                assert.isFalse(behaviorObj._addToCollection(undefined, {}));
                assert.isFalse(behaviorObj._addToCollection(234, {}));
                assert.isTrue(behaviorObj._addToCollection('only_string', {}));
            });

            it('add data to store', function() {
                assert.isTrue(behaviorObj._addToCollection('first_test_data', {key: 'value'}));
            });

            it('do not add data if collection already exist', function() {
                assert.isTrue(behaviorObj._addToCollection('single_data', {}));
                assert.isFalse(behaviorObj._addToCollection('single_data', {}));
            });
        });

        describe('_updateCollection method', function() {
            it('update existed collection', function() {
                assert.isTrue(behaviorObj._addToCollection('existed', {}));
                assert.isTrue(behaviorObj._updateCollection('existed', {test: 'test'}));
            });

            it('return false if collection is not exist', function() {
                assert.isFalse(behaviorObj._updateCollection('not_existed', {test: 'test'}));
            });

            it('accept only object as second argument', function() {
                assert.isTrue(behaviorObj._addToCollection('update', {}));

                assert.isFalse(behaviorObj._updateCollection('update', []));
                assert.isFalse(behaviorObj._updateCollection('update', ''));
                assert.isTrue(behaviorObj._updateCollection('update', {}));
            });
        });

        describe('isEditable method', function() {
            var test_data = {
                "id": {
                    "type": "integer",
                    "required": false,
                    "read_only": true,
                    "label": "ID"
                },
                "agreement": {
                    "type": "field",
                    "required": true,
                    "read_only": false,
                    "label": "Agreement"
                },
                "staff_members": {
                    "type": "field",
                    "required": false,
                    "read_only": false,
                    "label": "Staff members",
                    "child": {
                        "type": "nested object",
                        "required": false,
                        "read_only": false,
                        "children": {
                            "id": {
                                "type": "integer",
                                "required": false,
                                "read_only": true,
                                "label": "ID"
                            },
                            "title": {
                                "type": "string",
                                "required": false,
                                "read_only": false,
                                "label": "Title",
                                "max_length": 64
                            }
                        }
                    }
                }
            };

            before(function () {
                behaviorObj._addToCollection('test', test_data);
            });

            beforeEach(function () {
                behaviorObj._updateCollection('test', test_data);
            });

            it('return read_only field of collection items', function() {
                assert.isTrue(behaviorObj.isEditable('test', 'id'));
                assert.isFalse(behaviorObj.isEditable('test', 'agreement'));
            });

            it('return false if collection is not exist', function() {
                assert.isFalse(behaviorObj.isEditable('test_not_found', 'id'));
            });

            it('throw an exception if arguments are not provided', function() {
                var first = behaviorObj.isEditable.bind(behaviorObj, null, 'id'),
                    second = behaviorObj.isEditable.bind(behaviorObj, 'id'),
                    third = behaviorObj.isEditable.bind(behaviorObj, 'test_not_found', 'id');

                assert.throws(first);
                assert.throws(second);
                assert.doesNotThrow(third);
            });
        });



    });
</script>

</body>
</html>

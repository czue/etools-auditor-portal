<!--import [polymer, paper-icon-button, paper-input, etools-checkable-input, paper-icon-button, etools-content-panel, iron-icon,
            iron-icons, iron-icons/communication-icons]-->

<!--import [tab-inputs-styles, repeatable-data-sets-behavior, permission-controller, list-header, list-element, dialog-element,
            lodash, table-elements-behavior, error-handler-behavior]-->

<dom-module id="engagement-staff-members-tab">
    <template>
        <!-- inject styles './engagement-staff-members-tab.scss'-->
        <style include="tab-inputs-styles module-styles"></style>

        <get-staff-members-list organisation-id="[[organisationId]]" queries="{{listQueries}}" data-items="{{dataItems}}"></get-staff-members-list>
        <update-staff-members organisation-id="[[organisationId]]" staff-data="{{newData}}"></update-staff-members>


        <paper-icon-button hidden$="[[!_canBeChanged(basePermissionPath)]]"
                           title="Add"
                           on-tap="openAddDialog"
                           class="add-button"
                           icon="add"></paper-icon-button>

        <etools-content-panel panel-title="Auditor Staff Members ([[dataItems.length]])" show-expand-btn>

            <list-header no-additional no-ordered data="[[columns]]"></list-header>

            <template is="dom-repeat" items="[[dataItems]]" filter="_showItems">
                <list-element
                        class="list-element"
                        data="[[item]]"
                        no-additional
                        headings="[[columns]]"
                        no-animation>
                    <div slot="icon" class="edit-icon-slot">
                        <paper-icon-button icon="create" class="edit-icon" on-tap="openEditDialog"></paper-icon-button>
                    </div>
                    <div slot="checkbox">
                        <paper-checkbox on-tap="_isActive"
                                        label=""></paper-checkbox>
                    </div>
                </list-element>
            </template>

            <template is="dom-if" if="[[!dataItems.length]]">
                <list-element
                        class="list-element"
                        data="[[emptyObj]]"
                        no-additional
                        headings="[[columns]]"
                        no-animation></list-element>
            </template>


        </etools-content-panel>

        <dialog-element opened="{{dialogOpened}}" dialog-title="[[dialogTitle]]" confirm-btn-text="[[confirmBtnText]]" request-in-process="{{requestInProcess}}">

            <div class="row-h repeatable-item-container" without-line$="[[!canBeRemoved]]">

                <div class="repeatable-item-actions" hidden$="[[!canBeRemoved]]">
                    <div class="row-v actions">
                        <paper-icon-button class="action delete"
                                           on-tap="_openDeleteConfirmation"
                                           disabled="{{requestInProcess}}"
                                           icon="cancel"></paper-icon-button>
                    </div>
                </div>

                <div class="repeatable-item-content">
                    <div class="row-h group">
                        <div class="input-container" title="{{_getTitleValue(editedItem.user.email)}}">
                            <!-- Email address -->
                            <paper-input label="E-mail address"
                                         value="{{editedItem.user.email}}"
                                         placeholder="Enter E-mail"
                                         class$="validate-input {{_setRequired('user.email', basePermissionPath)}}"
                                         required="{{_setRequired('user.email', basePermissionPath)}}"
                                         disabled="{{_emailDisabled(requestInProcess, canBeRemoved)}}"
                                         readonly$="{{_emailDisabled(requestInProcess, canBeRemoved)}}"
                                         on-focus="_resetFieldError"
                                         id="emailInput"
                                         invalid="{{errors.user.email}}"
                                         error-message="{{errors.user.email}}">
                                <iron-icon prefix icon="communication:email"></iron-icon>
                            </paper-input>

                        </div>

                        <div class="input-container" title="{{_getTitleValue(editedItem.user.first_name)}}">
                            <!-- First Name -->
                            <paper-input label="First Name"
                                         value="{{editedItem.user.first_name}}"
                                         placeholder="Enter First Name"
                                         class$="validate-input {{_setRequired('user.first_name', basePermissionPath)}}"
                                         required="{{_setRequired('user.first_name', basePermissionPath)}}"
                                         invalid="{{errors.user.first_name}}"
                                         error-message="{{errors.user.first_name}}"
                                         disabled="{{requestInProcess}}"
                                         readonly$="{{requestInProcess}}"
                                         on-focus="_resetFieldError">
                            </paper-input>
                        </div>
                        <div class="input-container" title="{{_getTitleValue(editedItem.user.last_name)}}">
                            <!-- Last Name -->
                            <paper-input label="Last Name"
                                         value="{{editedItem.user.last_name}}"
                                         placeholder="Enter Last Name"
                                         class$="validate-input {{_setRequired('user.last_name', basePermissionPath)}}"
                                         required="{{_setRequired('user.last_name', basePermissionPath)}}"
                                         invalid="{{errors.user.last_name}}"
                                         error-message="{{errors.user.last_name}}"
                                         disabled="{{requestInProcess}}"
                                         readonly$="{{requestInProcess}}"
                                         on-focus="_resetFieldError">
                            </paper-input>
                        </div>
                    </div>
                    <div class="input-container" title="{{_getTitleValue(editedItem.user.profile.job_title)}}">
                        <!-- Position -->
                        <paper-input label="Position"
                                     value="{{editedItem.user.profile.job_title}}"
                                     placeholder="Enter Position"
                                     on-focus="_resetFieldError"
                                     class$="validate-input {{_setRequired('user.profile.job_title', basePermissionPath)}}"
                                     disabled="{{requestInProcess}}"
                                     readonly$="{{requestInProcess}}"
                                     required="{{_setRequired('user.profile.job_title', basePermissionPath)}}"
                                     invalid="{{errors.profile.job_title}}"
                                     error-message="{{errors.profile.job_title}}">
                        </paper-input>
                    </div>
                    <div class="row-h group">
                        <div class="input-container" title="{{_getTitleValue(editedItem.user.profile.phone_number)}}">
                            <!-- Phone number -->
                            <paper-input label="Phone number"
                                         value="{{editedItem.user.profile.phone_number}}"
                                         allowed-pattern="[\d\s-]"
                                         placeholder="Enter Phone"
                                         class$="validate-input {{_setRequired('user.profile.phone_number', basePermissionPath)}}"
                                         disabled="{{requestInProcess}}"
                                         readonly$="{{requestInProcess}}"
                                         invalid="{{errors.user.profile.phone_number}}"
                                         error-message="{{errors.user.profile.phone_number}}"
                                         required="{{_setRequired('user.profile.phone_number', basePermissionPath)}}">
                                <iron-icon prefix icon="communication:phone"></iron-icon>
                            </paper-input>
                        </div>


                    </div>

                    <div class="row-h group">
                        <!--receive notification-->
                        <div class="staff-check-box notify-box input-container input-container-l">
                            <etools-checkable-input checked="{{editedItem.receive_audit_notifications}}"
                                                    label="Receive Notifications on Audit Tasks?"
                                                    disabled="{{requestInProcess}}"
                                                    readonly$="{{requestInProcess}}"
                                                    type="checkbox"
                                                    label-alignment="right">
                            </etools-checkable-input>
                        </div>
                    </div>

                </div>
            </div>
        </dialog-element>

        <div class="confirm-backdrop"  opened$="{{confirmDialogOpened}}"></div>
        <dialog-element dialog-name="deleteConfirm" opened="{{confirmDialogOpened}}" dialog-title="Remove Staff Member" confirm-btn-text="Ok">
            <div class="confirm-text">Do you want to remove this staff member?</div>
        </dialog-element>
    </template>

    <!-- inject scripts './engagement-staff-members-tab.js'-->
</dom-module>
<!--import [polymer, app-route, app-layout, paper-tabs, iron-pages, app-route/app-location, lodash, etools-content-panel]-->

<!--import [shared-styles, module-styles, main-page-styles, app-main-header, pages-header-element, file-attachments-tab,
            update-engagement, status-tab-element, engagement-staff-members-tab, engagement-info-details,
            engagement-info-data, engagement-behavior, sc-report-page-main, partner-details-tab]-->

<dom-module id="spot-checks-page-main">
    <template>
        <style include="shared-styles module-styles main-page-styles"></style>

        <app-route
                route="{{route}}"
                pattern="/:id/:tab"
                data="{{routeData}}"></app-route>

        <engagement-info-data engagement-id="{{engagementId}}"
                              engagement-type="spot-checks"
                              engagement-info="{{engagement}}"></engagement-info-data>

        <update-engagement updated-engagement-data="{{updatedEngagement}}"
                           quiet-adding="{{quietAdding}}"
                           engagement="{{engagement}}"
                           error-object="{{errorObject}}"
                           base-permission-path="{{permissionBase}}"></update-engagement>


        <template is="dom-if" if="{{engagement.id}}" restamp>
            <pages-header-element show-export-button
                                  hide-print-button
                                  title$="[[engagement.partner.name]] - Spot Check"></pages-header-element>
            <div class="tab-selector">
                <paper-tabs attr-for-selected="name" noink bottom-item role="tablist" tabindex="0"
                            selected="{{tab}}" id="pageTabs">
                    <paper-tab name="overview"><span class="tab-content">Engagement Overview</span></paper-tab>

                    <template is="dom-if" if="{{_showReportTabs(permissionBase, engagement)}}" restamp>
                        <paper-tab name="report"><span class="tab-content">Report</span></paper-tab>
                    </template>

                    <paper-tab name="attachments"><span class="tab-content">Attachments</span></paper-tab>
                </paper-tabs>
            </div>

            <template is="dom-if" if="{{!_showReportTabs(permissionBase, engagement)}}" restamp>

                <div class="submitted-message">Engagement has been submitted to auditor</div>

            </template>

            <div class="view-container">

                <div id="pageContent">
                    <iron-pages id="info-tabs"
                                selected="{{tab}}"
                                attr-for-selected="name">

                        <div name="overview">
                            <engagement-info-details data="{{engagement}}"
                                                     id="engagementDetails"
                                                     error-object="{{errorObject}}"
                                                     original-data="[[originalData]]"
                                                     base-permission-path="{{permissionBase}}"></engagement-info-details>

                            <partner-details-tab id="partnerDetails"
                                                 original-data="[[originalData]]"
                                                 engagement="{{engagement}}"
                                                 error-object="{{errorObject}}"
                                                 base-permission-path="{{permissionBase}}"></partner-details-tab>


                            <engagement-staff-members-tab id="staffMembers"
                                                          base-permission-path="{{permissionBase}}"
                                                          engagement="{{engagement}}"
                                                          error-object="{{errorObject}}"></engagement-staff-members-tab>
                        </div>

                        <template is="dom-if" if="{{_showReportTabs(permissionBase, engagement)}}" restamp>
                            <div name="report">
                                <sc-report-page-main id="report"
                                                     original-data="[[originalData]]"
                                                     engagement="{{engagement}}"
                                                     error-object="{{errorObject}}"
                                                     permission-base="{{permissionBase}}"></sc-report-page-main>
                            </div>
                        </template>


                        <div name="attachments">
                            <file-attachments-tab title="Related Documents"
                                                  id="engagement_attachments"
                                                  main-property="engagement_attachments"
                                                  error-object="{{errorObject.engagement_attachments}}"
                                                  allow-download allow-edit file-type-required multiple
                                                  data-items="[[engagement.engagement_attachments]]"
                                                  file-types="[[engagementFileTypes]]"
                                                  readonly="[[_attachmentsReadonly(permissionBase, 'engagement_attachments')]]"></file-attachments-tab>

                            <template is="dom-if" if="{{_showReportTabs(permissionBase, engagement)}}" restamp>
                                <file-attachments-tab title="Report Attachments"
                                                      id="report_attachments"
                                                      main-property="report_attachments"
                                                      error-object="{{errorObject.report_attachments}}"
                                                      allow-download allow-edit file-type-required multiple
                                                      data-items="[[engagement.report_attachments]]"
                                                      file-types="[[reportFileTypes]]"
                                                      readonly="[[_attachmentsReadonly(permissionBase, 'report_attachments')]]"></file-attachments-tab>
                            </template>
                        </div>

                    </iron-pages>

                </div>

                <div id="sidebar">
                    <status-tab-element engagement-data="[[engagement]]" main-action-text="[[mainBtnText]]"
                                        other-actions="[[otherActions]]"></status-tab-element>
                </div>
            </div>
        </template>


    </template>

    <!-- inject scripts './spot-checks-page-main.js'-->
</dom-module>